<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <title>ODSC London - workshop introduction D3</title>
  <meta name="description" content="ODSC London - workshop introduction D3">
  <meta name="author" content="TULP interactive">
</head>

<body>
  <style>

  </style>

  <script src="js/d3.min.js" lang="Javascript"></script>

  <svg width="800" height="800">
    
  </svg>
  <input id="slider" type="range" min="0" max="100" value="50" />
  <script lang="Javascript">
    // d3.select('svg').append('text')
    //   .attr('x', 200)
    //   .attr('y', 200)
    //   .style('fill', 'red')
    //   .text('Hello ODSC London!')

    // d3.select('svg').append('text')
    //   .attr('x', 200)
    //   .attr('y', 200)
    //   .style('fill', 'steelblue')
    //   .text('This is fun!')

    // d3.select('svg').selectAll('text')
    //   .attr('y', function(d, i) { return 200 + i * 20 })

    // var texts = [
    //   { ix: 0, text: 'this is my first text' },
    //   { ix: 1, text: 'this is my second text' },
    //   { ix: 2, text: 'this is my third text' },
    //   { ix: 3, text: 'this is my final text, who would have thought '}
    // ]
    var texts = d3.range(10)
    // console.log('yes, it\'s working')

    function render() {
      var text = d3.select('svg').selectAll('text')
        .data(texts, function(d) { return d })
          
      text.style('fill', 'green') // UPDATE

      text.exit() // EXIT
        .style('fill', 'red')
        .remove()
        
      text.enter().append('text') // ENTER
        .attr('x', function(d) { return d})
        .style('fill', 'steelblue')
      .merge(text)
        .text(function(d) { return d }) // EMTER + UPDATE
        .attr('y', function(d, i) { return 200 + i * 20})
        
    }
    console.log(texts)
    render()
    texts.splice(1, 1)
    console.log(texts)
    render()
    texts[1] = 1000
    console.log(texts)
    render()

    d3.select('svg')
      .on('mousemove', function() {
        texts[4] = d3.mouse(this)[0]
        render()
      })
    
    const exponential = d3.range(10)
      .map(function(d) { return Math.pow(10, d)})

    const power = d3.range(10)
      .map(function(d) { return d * d})

    const sqrt = d3.range(10)
      .map(function(d) { return Math.sqrt(d)})

    const rnd = d3.range(10)
      .map(function(d) { return Math.random() * 10})

    const arc = d3.arc()
      .innerRadius(100)
      .outerRadius(200)
      .startAngle(0)
      .endAngle(Math.PI * 2)

    d3.select('svg').append('path')
      .attr('transform', 'translate(200, 200)')
      .style('fill', 'red')
      .style('stroke', 'black')
      .attr('d', arc)

    const angle = d3.scaleLinear()
      .domain([0, 100])
      .range([0, Math.PI * 2])

    d3.select('#slider')
      .on('input', function() {
        const value = d3.select(this).property('value')

        arc.endAngle(angle(value))
        
        d3.select('path')
          .attr('d', arc)
      })

    d3.select('svg').append('rect')
      .attr('x', 300)
      .attr('y', 300)
      .attr('width', 200)
      .attr('height', 100)
      .style('fill', 'steelblue')

    const x = d3.scaleLinear()
      .domain([0, rnd.length])
      .range([300, 700])

    const y = d3.scaleLinear()
      .domain(d3.extent(rnd))
      .range([500, 200])

    const line = d3.line()
      .x(function(d, i) { return x(i); })
      .y(function(d) { return y(d) })
      .curve(d3.curveStepAfter)

    d3.select('svg').append('path')
      .attr('d', line(rnd))
      .style('stroke', 'orange')
      .style('fill', 'none')
      .style('stroke-width', 7)
      .on('click', function() {
        d3.select(this)
          .style('stroke', 'rgb(' + (Math.random() * 255) + ', 127, 127)')
      })

    d3.select('svg').selectAll('.mark')
      .data(rnd)
      .enter().append('circle')
        .attr('cx', function(d, i) { return x(i)})
        .attr('cy', function(d) { return y(d)})
        .attr('r', 4)
        .style('fill', 'orange')
        .on('mouseover', function() {
          d3.select(this)
            .attr('r', 10)
        })
        .on('mouseout', function() {
          d3.select(this)
            .attr('r', 4)
        })

    d3.dsv(',', 'people.csv', function(d) {
      return {
        name: d.name,
        age: +d.age,
        height: +d.height
      }
    }).then(function(data) {
      console.log(data)
    })

    d3.json('people.json')
      .then(function(data) {
        console.log(data)
      })

    const myData = []

    function render2() {
      const dot = d3.select('svg').selectAll('.dot')
        .data(myData)

      dot.enter().append('circle')
        .attr('class', 'dot')
        .attr('cx', 400)
        .attr('cy', 400)
        .attr('r', 0)
        .style('fill', 'green')
        .transition()
          .duration(1000)
          // .ease(d3.easeQuadInOut)
          .attr('r', 30)
          .attr('cx', function(d) { return d[0] * 800 })
          .attr('cy', function(d) { return d[1] * 800 })
    }

    d3.select('body')
      .append('button')
      .text('add')
      .on('click', function() {
        myData.push([Math.random(), Math.random()])
        render2()
      })
  </script>
</body>
</html>